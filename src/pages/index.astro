---
import { createClient } from "@libsql/client";

const url = import.meta.env.TURSO_DATABASE_URL;
const authToken = import.meta.env.TURSO_AUTH_TOKEN;

const client = createClient({
  url: url,
  authToken: authToken,
});

let articles = [];
let debugError = null;

try {
  const rs = await client.execute("SELECT * FROM articles ORDER BY id DESC LIMIT 20");
  articles = rs.rows;
} catch (e) {
  debugError = e.message;
}
---

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KnowNow Tech</title>
</head>
<body>
    <h1>Latest Trending Articles</h1>
    
    <div class="content">
        {articles.length > 0 ? (
            articles.map((post) => (
                <article style="border-bottom: 1px solid #ccc; padding: 1rem 0;">
                    <h2>{post.title}</h2>
                    <div set:html={post.content}></div>
                </article>
            ))
        ) : (
            <p style="color: red;">⚠️ No articles found in database during build.</p>
        )}
    </div>

    <hr />
    <section style="background: #eee; padding: 1rem; font-family: monospace; font-size: 12px;">
        <h3>Build Debugger</h3>
        <p>DB URL Configured: {url ? "✅ Yes" : "❌ Missing"}</p>
        <p>Auth Token Configured: {authToken ? "✅ Yes" : "❌ Missing"}</p>
        <p>Articles Count: {articles.length}</p>
        {debugError && <p style="color: red;">Error: {debugError}</p>}
    </section>
</body>
</html>