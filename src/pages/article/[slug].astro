---
import Database from 'better-sqlite3';
import path from 'path';

export async function getStaticPaths() {
  const dbPath = path.resolve('content.db');
  const db = new Database(dbPath);
  
  try {
    const rows = db.prepare("SELECT slug FROM articles WHERE slug IS NOT NULL").all();
    console.log(`Building ${rows.length} article pages from SQLite...`);
    
    return rows.map((row) => ({
      params: { slug: String(row.slug) },
    }));
  } catch (e) {
    console.error("getStaticPaths SQLite Error:", e);
    return [];
  }
}

const { slug } = Astro.params;
const dbPath = path.resolve('content.db');
const db = new Database(dbPath);

// Fetch the specific post for this slug
const post = db.prepare("SELECT * FROM articles WHERE slug = ?").get(slug) || {
  title: "Not Found",
  content: "This article could not be found.",
  image_url: ""
};
---

<article style="max-width: 750px; margin: 4rem auto; padding: 0 1.5rem; line-height: 1.8; font-family: 'Inter', sans-serif;">
  <a href="/knownow/" style="text-decoration: none; color: #666;">‚Üê Back to Pulse</a>
  
  {post.image_url && (
    <img src={post.image_url} style="width: 100%; border-radius: 16px; margin: 2rem 0;" alt={post.title} />
  )}
  
  <h1 style="font-size: 2.5rem; line-height: 1.2; margin-bottom: 2rem;">{post.title}</h1>
  <div set:html={post.content} class="prose" />
</article>