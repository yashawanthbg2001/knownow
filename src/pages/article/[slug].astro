---
import { createClient } from "@libsql/client";

export async function getStaticPaths() {
  const DB_URL = "libsql://content-gen-yashawanth.aws-ap-south-1.turso.io";
  const DB_TOKEN = "eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVCJ9.eyJhIjoicnciLCJpYXQiOjE3NjkyNzI3MzAsImlkIjoiZmIwZWU4ZWItZmZhOS00Y2RmLTk3NDctNWI4ODViY2ZlNjlkIiwicmlkIjoiNzhlZWQ2YWYtODNkMC00OWU0LTg3MjEtMjBhNTQ1YTk4ZDQ3In0.IiHkGPV3aKuPkc_q-1efWQdnH2YM4QKtT2_MzyNZgQEmYMs84MneQZ-RM912mF8DZdH3Fpk2LSvfoUr6HvG5AA";

  const client = createClient({ url: DB_URL, authToken: DB_TOKEN });
  
  try {
    const rs = await client.execute("SELECT slug FROM articles");
    console.log(`Found ${rs.rows.length} articles to build.`); // This shows up in GitHub logs
    
    return rs.rows.map((row) => ({
      params: { slug: String(row.slug) },
    }));
  } catch (e) {
    console.error("Fetch error:", e);
    return [];
  }
}

const { slug } = Astro.params;
const DB_URL = "libsql://content-gen-yashawanth.aws-ap-south-1.turso.io";
const DB_TOKEN = "eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVCJ9.eyJhIjoicnciLCJpYXQiOjE3NjkyNzI3MzAsImlkIjoiZmIwZWU4ZWItZmZhOS00Y2RmLTk3NDctNWI4ODViY2ZlNjlkIiwicmlkIjoiNzhlZWQ2YWYtODNkMC00OWU0LTg3MjEtMjBhNTQ1YTk4ZDQ3In0.IiHkGPV3aKuPkc_q-1efWQdnH2YM4QKtT2_MzyNZgQEmYMs84MneQZ-RM912mF8DZdH3Fpk2LSvfoUr6HvG5AA";

const client = createClient({ url: DB_URL, authToken: DB_TOKEN });
const rs = await client.execute({
  sql: "SELECT * FROM articles WHERE slug = ?",
  args: [slug]
});
const post = rs.rows[0];
---


<article style="max-width: 750px; margin: 4rem auto; padding: 0 1.5rem; line-height: 1.8; font-family: 'Inter', sans-serif;">
  <a href="/" style="text-decoration: none; color: #666;">‚Üê Back to Pulse</a>
  <img src={post.image_url as string} style="width: 100%; border-radius: 16px; margin: 2rem 0;" />
  <h1 style="font-size: 2.5rem; line-height: 1.2; margin-bottom: 2rem;">{post.title}</h1>
  <div set:html={post.content} class="prose" />
</article>