---
import { createClient } from "@libsql/client";

export async function getStaticPaths() {
  const client = createClient({
    url: import.meta.env.TURSO_DATABASE_URL,
    authToken: import.meta.env.TURSO_AUTH_TOKEN,
  });
  const rs = await client.execute("SELECT slug FROM articles");
  return rs.rows.map((row) => ({ params: { slug: row.slug } }));
}

const { slug } = Astro.params;
const client = createClient({
  url: import.meta.env.TURSO_DATABASE_URL,
  authToken: import.meta.env.TURSO_AUTH_TOKEN,
});
const rs = await client.execute({
  sql: "SELECT * FROM articles WHERE slug = ?",
  args: [slug]
});
const post = rs.rows[0];
---

<article style="max-width: 800px; margin: auto; padding: 2rem; font-family: sans-serif;">
  <img src={post.image_url} style="width: 100%; border-radius: 12px;" />
  <h1 style="font-size: 3rem;">{post.title}</h1>
  <div set:html={post.content} class="prose" />
  <hr />
  <p>Source: <a href={post.source_url as string}>Wikipedia</a></p>
</article>